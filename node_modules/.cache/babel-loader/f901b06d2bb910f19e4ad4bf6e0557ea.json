{"ast":null,"code":"const prefixes = ['webkit'];\n\nclass Grade {\n  constructor(container, img_selector, callback) {\n    this.callback = callback || null;\n    this.container = container;\n    this.image = this.container.querySelector(img_selector) || this.container.querySelector('img');\n    this.gradientData = [];\n\n    if (!this.image || !this.container) {\n      return;\n    }\n\n    this.canvas = document.createElement('canvas');\n    this.ctx = this.canvas.getContext('2d');\n    this.imageDimensions = {\n      width: 0,\n      height: 0\n    };\n    this.imageData = [];\n    this.readImage();\n  }\n\n  readImage() {\n    this.imageDimensions.width = this.image.width * 0.1;\n    this.imageDimensions.height = this.image.height * 0.1;\n    this.render();\n  }\n\n  getImageData() {\n    let imageData = this.ctx.getImageData(0, 0, this.imageDimensions.width, this.imageDimensions.height).data;\n    this.imageData = Array.from(imageData);\n  }\n\n  getChunkedImageData() {\n    const perChunk = 4;\n    let chunked = this.imageData.reduce((ar, it, i) => {\n      const ix = Math.floor(i / perChunk);\n\n      if (!ar[ix]) {\n        ar[ix] = [];\n      }\n\n      ar[ix].push(it);\n      return ar;\n    }, []);\n    let filtered = chunked.filter(rgba => {\n      return rgba.slice(0, 2).every(val => val < 250) && rgba.slice(0, 2).every(val => val > 0);\n    });\n    return filtered;\n  }\n\n  getRGBAGradientValues(top) {\n    return top.map((color, index) => {\n      return `rgb(${color.rgba.slice(0, 3).join(',')}) ${index == 0 ? '0%' : '75%'}`;\n    }).join(',');\n  }\n\n  getCSSGradientProperty(top) {\n    const val = this.getRGBAGradientValues(top);\n    return prefixes.map(prefix => {\n      return `background-image: -${prefix}-linear-gradient(\n                        135deg,\n                        ${val}\n                    )`;\n    }).concat([`background-image: linear-gradient(\n                    135deg,\n                    ${val}\n                )`]).join(';');\n  }\n\n  getMiddleRGB(start, end) {\n    let w = 0.5 * 2 - 1;\n    let w1 = (w + 1) / 2.0;\n    let w2 = 1 - w1;\n    let rgb = [parseInt(start[0] * w1 + end[0] * w2), parseInt(start[1] * w1 + end[1] * w2), parseInt(start[2] * w1 + end[2] * w2)];\n    return rgb;\n  }\n\n  getSortedValues(uniq) {\n    const occurs = Object.keys(uniq).map(key => {\n      const rgbaKey = key;\n      let components = key.split('|'),\n          brightness = (components[0] * 299 + components[1] * 587 + components[2] * 114) / 1000;\n      return {\n        rgba: rgbaKey.split('|'),\n        occurs: uniq[key],\n        brightness\n      };\n    }).sort((a, b) => a.occurs - b.occurs).reverse().slice(0, 10);\n    return occurs.sort((a, b) => a.brightness - b.brightness).reverse();\n  }\n\n  getTextProperty(top) {\n    let rgb = this.getMiddleRGB(top[0].rgba.slice(0, 3), top[1].rgba.slice(0, 3));\n    let o = Math.round((parseInt(rgb[0]) * 299 + parseInt(rgb[1]) * 587 + parseInt(rgb[2]) * 114) / 1000);\n\n    if (o > 125) {\n      return 'color: #000';\n    } else {\n      return 'color: #fff';\n    }\n  }\n\n  getTopValues(uniq) {\n    let sorted = this.getSortedValues(uniq);\n    return [sorted[0], sorted[sorted.length - 1]];\n  }\n\n  getUniqValues(chunked) {\n    return chunked.reduce((accum, current) => {\n      let key = current.join('|');\n\n      if (!accum[key]) {\n        accum[key] = 1;\n        return accum;\n      }\n\n      accum[key] = ++accum[key];\n      return accum;\n    }, {});\n  }\n\n  renderGradient() {\n    const ls = window.localStorage;\n    const item_name = `grade-${this.image.getAttribute('src')}`;\n    let top = null;\n\n    if (ls && ls.getItem(item_name)) {\n      top = JSON.parse(ls.getItem(item_name));\n    } else {\n      let chunked = this.getChunkedImageData();\n      top = this.getTopValues(this.getUniqValues(chunked));\n\n      if (ls) {\n        ls.setItem(item_name, JSON.stringify(top));\n      }\n    }\n\n    if (this.callback) {\n      this.gradientData = top;\n      return;\n    }\n\n    let gradientProperty = this.getCSSGradientProperty(top);\n    let textProperty = this.getTextProperty(top);\n    let style = `${this.container.getAttribute('style') || ''}; ${gradientProperty}; ${textProperty}`;\n    this.container.setAttribute('style', style);\n  }\n\n  render() {\n    this.canvas.width = this.imageDimensions.width;\n    this.canvas.height = this.imageDimensions.height;\n    this.ctx.drawImage(this.image, 0, 0, this.imageDimensions.width, this.imageDimensions.height);\n    this.getImageData();\n    this.renderGradient();\n  }\n\n}\n\nmodule.exports = (containers, img_selector, callback) => {\n  const init = (container, img_selector, callback) => {\n    let grade = new Grade(container, img_selector, callback),\n        gradientData = grade.gradientData;\n\n    if (!gradientData.length) {\n      return null;\n    }\n\n    return {\n      element: container,\n      gradientData\n    };\n  };\n\n  let results = (NodeList.prototype.isPrototypeOf(containers) ? Array.from(containers).map(container => init(container, img_selector, callback)) : [init(containers, img_selector, callback)]).filter(Boolean);\n\n  if (results.length) {\n    return callback(results);\n  }\n};","map":{"version":3,"sources":["/home/ryan/Music/SantuyApp/node_modules/grade-js/src/index.js"],"names":["prefixes","Grade","constructor","container","img_selector","callback","image","querySelector","gradientData","canvas","document","createElement","ctx","getContext","imageDimensions","width","height","imageData","readImage","render","getImageData","data","Array","from","getChunkedImageData","perChunk","chunked","reduce","ar","it","i","ix","Math","floor","push","filtered","filter","rgba","slice","every","val","getRGBAGradientValues","top","map","color","index","join","getCSSGradientProperty","prefix","concat","getMiddleRGB","start","end","w","w1","w2","rgb","parseInt","getSortedValues","uniq","occurs","Object","keys","key","rgbaKey","components","split","brightness","sort","a","b","reverse","getTextProperty","o","round","getTopValues","sorted","length","getUniqValues","accum","current","renderGradient","ls","window","localStorage","item_name","getAttribute","getItem","JSON","parse","setItem","stringify","gradientProperty","textProperty","style","setAttribute","drawImage","module","exports","containers","init","grade","element","results","NodeList","prototype","isPrototypeOf","Boolean"],"mappings":"AAAA,MAAMA,QAAQ,GAAG,CAAC,QAAD,CAAjB;;AAEA,MAAMC,KAAN,CAAY;AACRC,EAAAA,WAAW,CAACC,SAAD,EAAYC,YAAZ,EAA0BC,QAA1B,EAAoC;AAC3C,SAAKA,QAAL,GAAgBA,QAAQ,IAAI,IAA5B;AACA,SAAKF,SAAL,GAAiBA,SAAjB;AACA,SAAKG,KAAL,GAAa,KAAKH,SAAL,CAAeI,aAAf,CAA6BH,YAA7B,KAA8C,KAAKD,SAAL,CAAeI,aAAf,CAA6B,KAA7B,CAA3D;AACA,SAAKC,YAAL,GAAoB,EAApB;;AACA,QAAG,CAAC,KAAKF,KAAN,IAAe,CAAC,KAAKH,SAAxB,EAAkC;AAC9B;AACH;;AACD,SAAKM,MAAL,GAAcC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAd;AACA,SAAKC,GAAL,GAAW,KAAKH,MAAL,CAAYI,UAAZ,CAAuB,IAAvB,CAAX;AACA,SAAKC,eAAL,GAAuB;AACnBC,MAAAA,KAAK,EAAE,CADY;AAEnBC,MAAAA,MAAM,EAAE;AAFW,KAAvB;AAIA,SAAKC,SAAL,GAAiB,EAAjB;AACA,SAAKC,SAAL;AACH;;AAEDA,EAAAA,SAAS,GAAG;AACR,SAAKJ,eAAL,CAAqBC,KAArB,GAA6B,KAAKT,KAAL,CAAWS,KAAX,GAAmB,GAAhD;AACA,SAAKD,eAAL,CAAqBE,MAArB,GAA8B,KAAKV,KAAL,CAAWU,MAAX,GAAoB,GAAlD;AACA,SAAKG,MAAL;AACH;;AAEDC,EAAAA,YAAY,GAAG;AACX,QAAIH,SAAS,GAAG,KAAKL,GAAL,CAASQ,YAAT,CACZ,CADY,EACT,CADS,EACN,KAAKN,eAAL,CAAqBC,KADf,EACsB,KAAKD,eAAL,CAAqBE,MAD3C,EAEdK,IAFF;AAGA,SAAKJ,SAAL,GAAiBK,KAAK,CAACC,IAAN,CAAWN,SAAX,CAAjB;AACH;;AAEDO,EAAAA,mBAAmB,GAAG;AAClB,UAAMC,QAAQ,GAAG,CAAjB;AAEA,QAAIC,OAAO,GAAG,KAAKT,SAAL,CAAeU,MAAf,CAAsB,CAACC,EAAD,EAAKC,EAAL,EAASC,CAAT,KAAe;AAC/C,YAAMC,EAAE,GAAGC,IAAI,CAACC,KAAL,CAAWH,CAAC,GAAGL,QAAf,CAAX;;AACA,UAAI,CAACG,EAAE,CAACG,EAAD,CAAP,EAAa;AACTH,QAAAA,EAAE,CAACG,EAAD,CAAF,GAAS,EAAT;AACH;;AACDH,MAAAA,EAAE,CAACG,EAAD,CAAF,CAAOG,IAAP,CAAYL,EAAZ;AACA,aAAOD,EAAP;AACH,KAPa,EAOX,EAPW,CAAd;AASA,QAAIO,QAAQ,GAAGT,OAAO,CAACU,MAAR,CAAeC,IAAI,IAAI;AAClC,aAAOA,IAAI,CAACC,KAAL,CAAW,CAAX,EAAc,CAAd,EAAiBC,KAAjB,CAAuBC,GAAG,IAAIA,GAAG,GAAG,GAApC,KAA4CH,IAAI,CAACC,KAAL,CAAW,CAAX,EAAc,CAAd,EAAiBC,KAAjB,CAAuBC,GAAG,IAAIA,GAAG,GAAG,CAApC,CAAnD;AACH,KAFc,CAAf;AAIA,WAAOL,QAAP;AACH;;AAEDM,EAAAA,qBAAqB,CAACC,GAAD,EAAM;AACvB,WAAOA,GAAG,CAACC,GAAJ,CAAQ,CAACC,KAAD,EAAQC,KAAR,KAAkB;AAC7B,aAAQ,OAAMD,KAAK,CAACP,IAAN,CAAWC,KAAX,CAAiB,CAAjB,EAAoB,CAApB,EAAuBQ,IAAvB,CAA4B,GAA5B,CAAiC,KAAID,KAAK,IAAI,CAAT,GAAa,IAAb,GAAoB,KAAM,EAA7E;AACH,KAFM,EAEJC,IAFI,CAEC,GAFD,CAAP;AAGH;;AAEDC,EAAAA,sBAAsB,CAACL,GAAD,EAAM;AACxB,UAAMF,GAAG,GAAG,KAAKC,qBAAL,CAA2BC,GAA3B,CAAZ;AACA,WAAO1C,QAAQ,CAAC2C,GAAT,CAAaK,MAAM,IAAI;AAC1B,aAAQ,sBAAqBA,MAAO;AAChD;AACA,0BAA0BR,GAAI;AAC9B,sBAHY;AAIH,KALM,EAKJS,MALI,CAKG,CAAE;AACpB;AACA,sBAAsBT,GAAI;AAC1B,kBAHkB,CALH,EAQMM,IARN,CAQW,GARX,CAAP;AASH;;AAEDI,EAAAA,YAAY,CAACC,KAAD,EAAQC,GAAR,EAAa;AACrB,QAAIC,CAAC,GAAG,MAAM,CAAN,GAAU,CAAlB;AACA,QAAIC,EAAE,GAAG,CAACD,CAAC,GAAG,CAAL,IAAU,GAAnB;AACA,QAAIE,EAAE,GAAG,IAAID,EAAb;AACA,QAAIE,GAAG,GAAG,CAACC,QAAQ,CAACN,KAAK,CAAC,CAAD,CAAL,GAAWG,EAAX,GAAgBF,GAAG,CAAC,CAAD,CAAH,GAASG,EAA1B,CAAT,EAAwCE,QAAQ,CAACN,KAAK,CAAC,CAAD,CAAL,GAAWG,EAAX,GAAgBF,GAAG,CAAC,CAAD,CAAH,GAASG,EAA1B,CAAhD,EAA+EE,QAAQ,CAACN,KAAK,CAAC,CAAD,CAAL,GAAWG,EAAX,GAAgBF,GAAG,CAAC,CAAD,CAAH,GAASG,EAA1B,CAAvF,CAAV;AACA,WAAOC,GAAP;AACH;;AAEDE,EAAAA,eAAe,CAACC,IAAD,EAAO;AAClB,UAAMC,MAAM,GAAGC,MAAM,CAACC,IAAP,CAAYH,IAAZ,EAAkBhB,GAAlB,CAAsBoB,GAAG,IAAI;AACpC,YAAMC,OAAO,GAAGD,GAAhB;AACA,UAAIE,UAAU,GAAGF,GAAG,CAACG,KAAJ,CAAU,GAAV,CAAjB;AAAA,UACIC,UAAU,GAAG,CAAEF,UAAU,CAAC,CAAD,CAAV,GAAgB,GAAjB,GAAyBA,UAAU,CAAC,CAAD,CAAV,GAAgB,GAAzC,GAAiDA,UAAU,CAAC,CAAD,CAAV,GAAgB,GAAlE,IAA0E,IAD3F;AAEA,aAAO;AACH5B,QAAAA,IAAI,EAAE2B,OAAO,CAACE,KAAR,CAAc,GAAd,CADH;AAEHN,QAAAA,MAAM,EAAED,IAAI,CAACI,GAAD,CAFT;AAGHI,QAAAA;AAHG,OAAP;AAKH,KATU,EASRC,IATQ,CASH,CAACC,CAAD,EAAIC,CAAJ,KAAUD,CAAC,CAACT,MAAF,GAAWU,CAAC,CAACV,MATpB,EAS4BW,OAT5B,GASsCjC,KATtC,CAS4C,CAT5C,EAS+C,EAT/C,CAAf;AAUA,WAAOsB,MAAM,CAACQ,IAAP,CAAY,CAACC,CAAD,EAAIC,CAAJ,KAAUD,CAAC,CAACF,UAAF,GAAeG,CAAC,CAACH,UAAvC,EAAmDI,OAAnD,EAAP;AACH;;AAEDC,EAAAA,eAAe,CAAC9B,GAAD,EAAM;AACjB,QAAIc,GAAG,GAAG,KAAKN,YAAL,CAAkBR,GAAG,CAAC,CAAD,CAAH,CAAOL,IAAP,CAAYC,KAAZ,CAAkB,CAAlB,EAAoB,CAApB,CAAlB,EAA0CI,GAAG,CAAC,CAAD,CAAH,CAAOL,IAAP,CAAYC,KAAZ,CAAkB,CAAlB,EAAoB,CAApB,CAA1C,CAAV;AACA,QAAImC,CAAC,GAAGzC,IAAI,CAAC0C,KAAL,CAAW,CAAEjB,QAAQ,CAACD,GAAG,CAAC,CAAD,CAAJ,CAAR,GAAmB,GAApB,GAA4BC,QAAQ,CAACD,GAAG,CAAC,CAAD,CAAJ,CAAR,GAAmB,GAA/C,GAAuDC,QAAQ,CAACD,GAAG,CAAC,CAAD,CAAJ,CAAR,GAAmB,GAA3E,IAAkF,IAA7F,CAAR;;AACA,QAAIiB,CAAC,GAAG,GAAR,EAAa;AACT,aAAO,aAAP;AACH,KAFD,MAEO;AACH,aAAO,aAAP;AACH;AACJ;;AAEDE,EAAAA,YAAY,CAAChB,IAAD,EAAO;AACf,QAAIiB,MAAM,GAAG,KAAKlB,eAAL,CAAqBC,IAArB,CAAb;AACA,WAAO,CAACiB,MAAM,CAAC,CAAD,CAAP,EAAYA,MAAM,CAACA,MAAM,CAACC,MAAP,GAAgB,CAAjB,CAAlB,CAAP;AACH;;AAEDC,EAAAA,aAAa,CAACpD,OAAD,EAAU;AACnB,WAAOA,OAAO,CAACC,MAAR,CAAe,CAACoD,KAAD,EAAQC,OAAR,KAAoB;AACtC,UAAIjB,GAAG,GAAGiB,OAAO,CAAClC,IAAR,CAAa,GAAb,CAAV;;AACA,UAAI,CAACiC,KAAK,CAAChB,GAAD,CAAV,EAAiB;AACbgB,QAAAA,KAAK,CAAChB,GAAD,CAAL,GAAa,CAAb;AACA,eAAOgB,KAAP;AACH;;AACDA,MAAAA,KAAK,CAAChB,GAAD,CAAL,GAAa,EAAGgB,KAAK,CAAChB,GAAD,CAArB;AACA,aAAOgB,KAAP;AACH,KARM,EAQJ,EARI,CAAP;AASH;;AAEDE,EAAAA,cAAc,GAAG;AACb,UAAMC,EAAE,GAAGC,MAAM,CAACC,YAAlB;AACA,UAAMC,SAAS,GAAI,SAAQ,KAAK/E,KAAL,CAAWgF,YAAX,CAAwB,KAAxB,CAA+B,EAA1D;AACA,QAAI5C,GAAG,GAAG,IAAV;;AAEA,QAAIwC,EAAE,IAAIA,EAAE,CAACK,OAAH,CAAWF,SAAX,CAAV,EAAiC;AAC7B3C,MAAAA,GAAG,GAAG8C,IAAI,CAACC,KAAL,CAAWP,EAAE,CAACK,OAAH,CAAWF,SAAX,CAAX,CAAN;AACH,KAFD,MAEO;AACH,UAAI3D,OAAO,GAAG,KAAKF,mBAAL,EAAd;AACAkB,MAAAA,GAAG,GAAG,KAAKiC,YAAL,CAAkB,KAAKG,aAAL,CAAmBpD,OAAnB,CAAlB,CAAN;;AAEA,UAAIwD,EAAJ,EAAQ;AACJA,QAAAA,EAAE,CAACQ,OAAH,CAAWL,SAAX,EAAsBG,IAAI,CAACG,SAAL,CAAejD,GAAf,CAAtB;AACH;AACJ;;AAED,QAAG,KAAKrC,QAAR,EAAiB;AACb,WAAKG,YAAL,GAAoBkC,GAApB;AACA;AACH;;AAED,QAAIkD,gBAAgB,GAAG,KAAK7C,sBAAL,CAA4BL,GAA5B,CAAvB;AAEA,QAAImD,YAAY,GAAG,KAAKrB,eAAL,CAAqB9B,GAArB,CAAnB;AAEA,QAAIoD,KAAK,GAAI,GAAE,KAAK3F,SAAL,CAAemF,YAAf,CAA4B,OAA5B,KAAwC,EAAG,KAAIM,gBAAiB,KAAIC,YAAa,EAAhG;AACA,SAAK1F,SAAL,CAAe4F,YAAf,CAA4B,OAA5B,EAAqCD,KAArC;AACH;;AAED3E,EAAAA,MAAM,GAAG;AACL,SAAKV,MAAL,CAAYM,KAAZ,GAAoB,KAAKD,eAAL,CAAqBC,KAAzC;AACA,SAAKN,MAAL,CAAYO,MAAZ,GAAqB,KAAKF,eAAL,CAAqBE,MAA1C;AACA,SAAKJ,GAAL,CAASoF,SAAT,CAAmB,KAAK1F,KAAxB,EAA+B,CAA/B,EAAkC,CAAlC,EAAqC,KAAKQ,eAAL,CAAqBC,KAA1D,EAAiE,KAAKD,eAAL,CAAqBE,MAAtF;AACA,SAAKI,YAAL;AACA,SAAK6D,cAAL;AACH;;AA1JO;;AA6JZgB,MAAM,CAACC,OAAP,GAAiB,CAACC,UAAD,EAAa/F,YAAb,EAA2BC,QAA3B,KAAwC;AACrD,QAAM+F,IAAI,GAAG,CAACjG,SAAD,EAAYC,YAAZ,EAA0BC,QAA1B,KAAuC;AAChD,QAAIgG,KAAK,GAAG,IAAIpG,KAAJ,CAAUE,SAAV,EAAqBC,YAArB,EAAmCC,QAAnC,CAAZ;AAAA,QACIG,YAAY,GAAG6F,KAAK,CAAC7F,YADzB;;AAEA,QAAG,CAACA,YAAY,CAACqE,MAAjB,EAAwB;AACpB,aAAO,IAAP;AACH;;AACD,WAAO;AACHyB,MAAAA,OAAO,EAAEnG,SADN;AAEHK,MAAAA;AAFG,KAAP;AAIH,GAVD;;AAWA,MAAI+F,OAAO,GAAG,CAACC,QAAQ,CAACC,SAAT,CAAmBC,aAAnB,CAAiCP,UAAjC,IACb7E,KAAK,CAACC,IAAN,CAAW4E,UAAX,EAAuBxD,GAAvB,CAA2BxC,SAAS,IAAIiG,IAAI,CAACjG,SAAD,EAAYC,YAAZ,EAA0BC,QAA1B,CAA5C,CADa,GAEb,CAAC+F,IAAI,CAACD,UAAD,EAAa/F,YAAb,EAA2BC,QAA3B,CAAL,CAFY,EAEgC+B,MAFhC,CAEuCuE,OAFvC,CAAd;;AAIA,MAAGJ,OAAO,CAAC1B,MAAX,EAAkB;AACd,WAAOxE,QAAQ,CAACkG,OAAD,CAAf;AACH;AACJ,CAnBD","sourcesContent":["const prefixes = ['webkit'];\n\nclass Grade {\n    constructor(container, img_selector, callback) {\n        this.callback = callback || null\n        this.container = container;\n        this.image = this.container.querySelector(img_selector) || this.container.querySelector('img')\n        this.gradientData = []\n        if(!this.image || !this.container){\n            return\n        }\n        this.canvas = document.createElement('canvas');\n        this.ctx = this.canvas.getContext('2d');\n        this.imageDimensions = {\n            width: 0,\n            height: 0\n        };\n        this.imageData = [];\n        this.readImage()\n    }\n\n    readImage() {\n        this.imageDimensions.width = this.image.width * 0.1;\n        this.imageDimensions.height = this.image.height * 0.1;\n        this.render()\n    }\n\n    getImageData() {\n        let imageData = this.ctx.getImageData(\n            0, 0, this.imageDimensions.width, this.imageDimensions.height\n        ).data;\n        this.imageData = Array.from(imageData)\n    }\n\n    getChunkedImageData() {\n        const perChunk = 4;\n\n        let chunked = this.imageData.reduce((ar, it, i) => {\n            const ix = Math.floor(i / perChunk)\n            if (!ar[ix]) {\n                ar[ix] = []\n            }\n            ar[ix].push(it);\n            return ar\n        }, []);\n\n        let filtered = chunked.filter(rgba => {\n            return rgba.slice(0, 2).every(val => val < 250) && rgba.slice(0, 2).every(val => val > 0)\n        });\n\n        return filtered\n    }\n\n    getRGBAGradientValues(top) {\n        return top.map((color, index) => {\n            return `rgb(${color.rgba.slice(0, 3).join(',')}) ${index == 0 ? '0%' : '75%'}`\n        }).join(',')\n    }\n\n    getCSSGradientProperty(top) {\n        const val = this.getRGBAGradientValues(top);\n        return prefixes.map(prefix => {\n            return `background-image: -${prefix}-linear-gradient(\n                        135deg,\n                        ${val}\n                    )`\n        }).concat([`background-image: linear-gradient(\n                    135deg,\n                    ${val}\n                )`]).join(';')\n    }\n\n    getMiddleRGB(start, end) {\n        let w = 0.5 * 2 - 1;\n        let w1 = (w + 1) / 2.0;\n        let w2 = 1 - w1;\n        let rgb = [parseInt(start[0] * w1 + end[0] * w2), parseInt(start[1] * w1 + end[1] * w2), parseInt(start[2] * w1 + end[2] * w2)];\n        return rgb;\n    }\n\n    getSortedValues(uniq) {\n        const occurs = Object.keys(uniq).map(key => {\n                const rgbaKey = key;\n                let components = key.split('|'),\n                    brightness = ((components[0] * 299) + (components[1] * 587) + (components[2] * 114)) / 1000\n                return {\n                    rgba: rgbaKey.split('|'),\n                    occurs: uniq[key],\n                    brightness\n                }\n            }).sort((a, b) => a.occurs - b.occurs).reverse().slice(0, 10);\n        return occurs.sort((a, b) => a.brightness - b.brightness).reverse()\n    }\n\n    getTextProperty(top) {\n        let rgb = this.getMiddleRGB(top[0].rgba.slice(0,3), top[1].rgba.slice(0,3));\n        let o = Math.round(((parseInt(rgb[0]) * 299) + (parseInt(rgb[1]) * 587) + (parseInt(rgb[2]) * 114)) /1000);\n        if (o > 125) {\n            return 'color: #000';\n        } else { \n            return 'color: #fff';\n        }\n    }\n\n    getTopValues(uniq) {\n        let sorted = this.getSortedValues(uniq);\n        return [sorted[0], sorted[sorted.length - 1]]\n    }\n\n    getUniqValues(chunked) {\n        return chunked.reduce((accum, current) => {\n            let key = current.join('|');\n            if (!accum[key]) {\n                accum[key] = 1;\n                return accum\n            }\n            accum[key] = ++(accum[key]);\n            return accum\n        }, {})\n    }\n\n    renderGradient() {\n        const ls = window.localStorage;\n        const item_name = `grade-${this.image.getAttribute('src')}`;\n        let top = null;\n\n        if (ls && ls.getItem(item_name)) {\n            top = JSON.parse(ls.getItem(item_name));\n        } else {\n            let chunked = this.getChunkedImageData();\n            top = this.getTopValues(this.getUniqValues(chunked));\n\n            if (ls) {\n                ls.setItem(item_name, JSON.stringify(top));\n            }\n        }\n\n        if(this.callback){\n            this.gradientData = top\n            return\n        }\n\n        let gradientProperty = this.getCSSGradientProperty(top);\n\n        let textProperty = this.getTextProperty(top);\n\n        let style = `${this.container.getAttribute('style') || ''}; ${gradientProperty}; ${textProperty}`;\n        this.container.setAttribute('style', style)\n    }\n\n    render() {\n        this.canvas.width = this.imageDimensions.width;\n        this.canvas.height = this.imageDimensions.height;\n        this.ctx.drawImage(this.image, 0, 0, this.imageDimensions.width, this.imageDimensions.height);\n        this.getImageData();\n        this.renderGradient();\n    }\n}\n\nmodule.exports = (containers, img_selector, callback) => {\n    const init = (container, img_selector, callback) => {\n        let grade = new Grade(container, img_selector, callback),\n            gradientData = grade.gradientData\n        if(!gradientData.length){\n            return null\n        }\n        return {\n            element: container,\n            gradientData\n        }\n    }\n    let results = (NodeList.prototype.isPrototypeOf(containers)\n    ? Array.from(containers).map(container => init(container, img_selector, callback))\n    : [init(containers, img_selector, callback)]).filter(Boolean)\n\n    if(results.length){\n        return callback(results)\n    }\n};\n"]},"metadata":{},"sourceType":"script"}